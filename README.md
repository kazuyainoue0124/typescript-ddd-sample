## メモ

### ドメイン駆動設計とは

- ドメイン駆動設計における「ドメイン」とは**ソフトウェアが解決しようとしている特定の問題領域**を指す
- 問題領域の核心を捉え、それをシステムに反映させるためのアプローチがドメイン駆動設計

### 戦略的設計とは

- 戦略的設計とは、ドメイン駆動設計のうち、**システム全体の設計アプローチ**を指す
- 主な要素は以下の 4 つ
  - ドメインモデリングによるコアドメインとサブドメインの定義
  - 境界づけられたコンテキストの設定
  - コンテキスト間の関係の定義
  - コンテキストの統合

### ドメインモデリングとは

- ドメインモデリングとは、**問題領域を理解し構造化された形で表現すること**を指す
- ドメインモデリングの目的は、**問題領域の理解を深め、問題領域をシステムに反映させるための要件やビジネスルールを構築する**こと

### 境界づけられたコンテキストとは

- 境界づけられたコンテキストとは、**特定の問題領域におけるモデルや言語を定義する境界**を指す
- 通常は 1 つのコンテキストに 1 つのモデルが対応する
- この境界の中で開発者とビジネスステークホルダーが共通の言語（ユビキタス言語）を共有し、問題領域を理解する

### 戦術的設計とは
- 戦術的設計とは、**ビジネス要件をコードに反映させるための具体的な設計アプローチ**を指す
- ドメイン駆動設計には固有のアーキテクチャはないが以下のアーキテクチャが選択肢となる
  - レイヤードアーキテクチャ
  - オニオンアーキテクチャ
  - ヘキサゴナルアーキテクチャ
  - クリーンアーキテクチャ

#### オニオンアーキテクチャ
- オニオンアーキテクチャはアプリケーションの中心にドメインモデルを据え、ドメインモデルを囲うように他の層を配置する
- ドメイン層が他の層に依存しないようにすることで、ドメインモデルを独立させて開発できるし、テストも簡単

### 値オブジェクトとは
- 値オブジェクトはドメイン内の値に関するビジネスロジックを表現するためのオブジェクト
- 値には以下の3つの特徴がある。値オブジェクトにおいてもこれらの特徴を持つ
  - 不変に保つ
  - 値同士を比較できる
  - 副作用がない
- 全ての値を値オブジェクトとして実装するのはコストがかかりすぎる。独自のビジネスロジックを持つ場合や再利用性が高い場合に限定する。

### エンティティとは
- エンティティはビジネス上の概念をモデル化して表現するためのオブジェクト
- エンティティは識別子として「ID」を割り当てることで、同一のエンティティを区別する
- 値オブジェクトは識別子を持たないが、エンティティは識別子を持つ
- 値オブジェクトは属性の値で同一性を判断する
- またエンティティは値オブジェクトと異なり、変更可能なオブジェクトである

### 集約とは
- 集約（Aggregate）とは関連するオブジェクト群を1つのユニットとして管理するための手法
- 集約は1つのルートエンティティと関連する値オブジェクト・エンティティで構成される
- ビジネスルールとデータの整合性を維持するために用いる
- 集約内のデータは同一のトランザクション内ですべて更新される（後述するリポジトリと関連）

### ドメインサービスとは
- ドメインサービスは値オブジェクトやエンティティだけでは自然に表現できないロジックを表現するためのオブジェクト
- ドメインサービスは闇雲に使わない。以下のようなケースで使用するのが良い
  - 複数の集約をまたいだ処理が必要な場合
  - DBへの問い合わせが必要な場合

### リポジトリとは
- リポジトリはインフラストラクチャ層のオブジェクト。集約の永続化を抽象化する役割をはたす（インターフェース）
- 主な目的はドメインモデルやビジネスロジックをデータ永続化の技術的な詳細（どのDB, ORMの利用有無など）から切り離すこと
- リポジトリの責務は集約の永続化と集約の復元の2つ
- ドメイン層が特定のDB技術やORMに依存してしまうと将来的な技術変更が困難になってしまう
- リポジトリを利用することで、ドメイン層はDB技術やORMに依存せずに開発できる
- ドメイン層のオブジェクトがインフラ層のリポジトリに依存してはいけないので、リポジトリのインターフェースを定義する必要がある
- ドメインモデルの永続化に関するトランザクションを管理するのはアプリケーション層の責務
- アプリケーションサービスはドメイン層の永続化を行う際にトランザクションを開始しコミットまたはロールバックする責務を持つ